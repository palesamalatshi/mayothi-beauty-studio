<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Booking | Mayothi Beauty Studio</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Poppins:wght@400;500&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: url('assets/images/background.jpg') center/cover fixed;
      color: #333738;
    }
    h1, h2 {
      font-family: 'Playfair Display', serif;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
    }
    .backdrop {
      background: rgba(255,255,255,0.85);
      border-radius: 1rem;
      box-shadow: 0 8px 24px rgba(0,0,0,0.1);
    }
    option[disabled] {
      color: #999;
    }

    /* Modal styles */
    .modal-bg {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 1rem;
    }
    .modal {
      background: white;
      border-radius: 1rem;
      max-width: 500px;
      width: 100%;
      padding: 2rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
      overflow-y: auto;
      max-height: 90vh;
    }
    .modal-header {
      font-family: 'Playfair Display', serif;
      font-size: 1.8rem;
      margin-bottom: 1rem;
      color: #f31777;
      text-align: center;
    }
    .modal-content {
      font-size: 1rem;
      line-height: 1.5;
      color: #333;
      max-height: 50vh;
      overflow-y: auto;
    }
    .modal-content strong {
      color: #f31777;
    }
    .modal-actions {
      margin-top: 1.5rem;
      display: flex;
      justify-content: center;
      gap: 1rem;
    }
    .btn-primary {
      background: #f31777;
      color: white;
      padding: 0.5rem 1.5rem;
      border-radius: 9999px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease;
      border: none;
      font-size: 1rem;
      box-shadow: 0 4px 12px rgba(243, 23, 119, 0.4);
    }
    .btn-primary:hover {
      background: #d40f61;
    }
    .btn-secondary {
      background: #408483;
      color: white;
      padding: 0.5rem 1.5rem;
      border-radius: 9999px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease;
      border: none;
      font-size: 1rem;
      box-shadow: 0 4px 12px rgba(64, 132, 131, 0.4);
    }
    .btn-secondary:hover {
      background: #2b6d6b;
    }
    /* PayFast form styling */
    #payfast-form {
      display: none;
      margin-top: 1rem;
      text-align: center;
    }
    #payfast-form button {
      background: #f31777;
      color: white;
      font-weight: 600;
      padding: 0.6rem 1.8rem;
      border-radius: 9999px;
      border: none;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(243, 23, 119, 0.4);
      transition: background 0.3s ease;
      font-size: 1rem;
    }
    #payfast-form button:hover {
      background: #d40f61;
    }
  </style>
</head>
<body>

<header class="fixed top-0 left-0 w-full z-50 shadow-md backdrop">
  <div class="max-w-6xl mx-auto flex justify-between items-center p-4">
    <div class="flex items-center gap-3">
      <img src="assets/images/logo.png" alt="Logo" class="w-16 h-16 object-contain rounded-full border-4 border-[#2b9a88] shadow-md" />
      <span class="text-2xl font-bold text-[#f31777]">Mayothi's Beauty Studio</span>
    </div>
    <nav class="space-x-4 hidden md:block text-sm font-medium">
      <a href="index.html" class="text-[#2b9a88] hover:text-[#f31777]">Home</a>
      <a href="about.html" class="hover:text-[#f31777]">About</a>
      <a href="services.html" class="hover:text-[#f31777]">Services</a>
      <a href="gallery.html" class="hover:text-[#f31777]">Gallery</a>
      <a href="booking.html" class="text-[#f31777] font-semibold">Booking</a>
      <a href="contact.html" class="hover:text-[#f31777]">Contact</a>
    </nav>
  </div>
</header>

<main class="pt-32 max-w-3xl mx-auto px-6 md:px-12 pb-16">
  <div class="backdrop p-8">
    <h1 class="text-4xl font-bold text-center mb-8 text-[#f31777]">Book Your Appointment</h1>

    <form id="bookingForm" class="space-y-6" novalidate>
      <div>
        <label for="name" class="block font-medium mb-1">Full Name<span class="text-red-500">*</span></label>
        <input type="text" id="name" name="name" required class="w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-2 focus:ring-[#f31777] focus:outline-none" />
      </div>

      <div>
        <label for="email" class="block font-medium mb-1">Email Address (optional)</label>
        <input type="email" id="email" name="email" class="w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-2 focus:ring-[#f31777] focus:outline-none" />
      </div>

      <div>
        <label for="phone" class="block font-medium mb-1">Phone Number<span class="text-red-500">*</span></label>
        <input type="tel" id="phone" name="phone" required class="w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-2 focus:ring-[#f31777] focus:outline-none" placeholder="e.g. 0610665969" />
      </div>

      <div>
        <label for="service" class="block font-medium mb-1">Select Service<span class="text-red-500">*</span></label>
        <select id="service" name="service" required class="w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-2 focus:ring-[#f31777] focus:outline-none">
          <option value="">Choose a service</option>
          <option value="nails">Nails</option>
          <option value="makeup">Make-up</option>
          <option value="weave">Weave Installation</option>
          <option value="cavitation">Cavitation Reduction</option>
        </select>
      </div>

      <div id="subServiceContainer" class="hidden">
        <label for="subservice" class="block font-medium mb-1">Choose Specific Option<span class="text-red-500">*</span></label>
        <select id="subservice" name="subservice" required class="w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-2 focus:ring-[#f31777] focus:outline-none">
          <option value="">Select an option...</option>
        </select>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label for="date" class="block font-medium mb-1">Preferred Date<span class="text-red-500">*</span></label>
          <input type="date" id="date" name="date" required class="w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-2 focus:ring-[#f31777] focus:outline-none" />
        </div>

        <div>
          <label for="time" class="block font-medium mb-1">Preferred Time<span class="text-red-500">*</span></label>
          <select id="time" name="time" required class="w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-2 focus:ring-[#f31777] focus:outline-none">
          </select>
        </div>
      </div>

      <div>
        <label for="paymentMethod" class="block font-medium mb-1">Payment Method<span class="text-red-500">*</span></label>
        <select id="paymentMethod" name="paymentMethod" required class="w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-2 focus:ring-[#f31777] focus:outline-none">
          <option value="">Choose payment method</option>
          <option value="card">Card (PayFast)</option>
          <option value="eft">EFT (Bank Transfer)</option>
        </select>
      </div>

      <div id="cardDetails" class="hidden space-y-4">
        <div>
          <label for="cardNumber" class="block font-medium mb-1">Card Number<span class="text-red-500">*</span></label>
          <input type="text" id="cardNumber" name="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19" inputmode="numeric" pattern="\d{4} ?\d{4} ?\d{4} ?\d{4}" class="w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-2 focus:ring-[#f31777] focus:outline-none" />
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label for="expiry" class="block font-medium mb-1">Expiry Date<span class="text-red-500">*</span></label>
            <input type="text" id="expiry" name="expiry" placeholder="MM/YY" maxlength="5" pattern="(0[1-9]|1[0-2])\/\d{2}" class="w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-2 focus:ring-[#f31777] focus:outline-none" />
          </div>
          <div>
            <label for="cvv" class="block font-medium mb-1">CVV<span class="text-red-500">*</span></label>
            <input type="password" id="cvv" name="cvv" placeholder="123" maxlength="4" pattern="\d{3,4}" inputmode="numeric" class="w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-2 focus:ring-[#f31777] focus:outline-none" />
          </div>
        </div>
      </div>

      <div>
        <label for="notes" class="block font-medium mb-1">Additional Notes</label>
        <textarea id="notes" name="notes" rows="4" class="w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-2 focus:ring-[#f31777] focus:outline-none" placeholder="e.g. I’d prefer a French tip set with rhinestones..."></textarea>
      </div>

      <div class="text-right font-semibold text-lg text-[#f31777]" id="priceDisplay">
        Total Price: R0
      </div>

      <div class="text-center">
        <button type="submit" id="submitBookingBtn" class="bg-[#f31777] hover:bg-[#d40f61] text-white font-semibold px-6 py-3 rounded-full shadow-md transition">Submit Booking</button>
      </div>
    </form>

    <!-- PayFast Payment Form -->
    <form action="https://www.payfast.co.za/eng/process" method="post" id="payfast-form" target="_blank" novalidate>
      <!-- Required merchant info -->
      <input type="hidden" name="merchant_id" value="YOUR_MERCHANT_ID" />
      <input type="hidden" name="merchant_key" value="YOUR_MERCHANT_KEY" />
      <input type="hidden" name="return_url" value="https://yourwebsite.com/success.html" />
      <input type="hidden" name="cancel_url" value="https://yourwebsite.com/cancelled.html" />
      <input type="hidden" name="notify_url" value="https://yourwebsite.com/notify.php" />

      <!-- Transaction info -->
      <input type="hidden" name="amount" id="payfast-amount" value="0.00" />
      <input type="hidden" name="item_name" value="Mayothi's Booking" />
      <input type="hidden" name="custom_str1" id="payfast-booking-info" value="" />

      <!-- Payment Button -->
      <button type="submit">Pay Now with PayFast</button>
    </form>

  </div>
</main>

<footer class="bg-white backdrop text-center py-6 mt-10 border-t border-gray-200">
  <p class="text-sm text-[#333738]">&copy; 2025 Mayothi’s Beauty Studio. Designed by <span class="text-[#f31777] font-semibold">Palesa Malatshi</span>.</p>
</footer>

<!-- Modal -->
<div id="bookingModal" class="modal-bg" role="dialog" aria-modal="true" aria-labelledby="modalTitle" tabindex="-1">
  <div class="modal">
    <h2 id="modalTitle" class="modal-header">Booking Confirmed!</h2>
    <div class="modal-content" id="modalContent"></div>
    <div class="modal-actions">
      <button id="closeModal" class="btn-secondary">Close</button>
    </div>
  </div>
</div>

<script>
  // Data maps for services and prices
  const priceMap = {
    nails: {
      'Short Plain Acrylic - R180': 180,
      'Short with Design Acrylic - R220': 220,
      'Medium Plain Acrylic - R220': 220,
      'Medium with Design Acrylic - R260': 260,
      'Large Plain Acrylic - R260': 260,
      'Large with Design Acrylic - R300': 300,
      'X-Large Plain Acrylic - R300': 300,
      'X-Large with Design Acrylic - R350': 350,
      'Gel Polish - R140': 140,
      'Gel Overlay - R100': 100,
      'Buff and Shine Plain - R100': 100,
      'Buff and Shine with Design - R140': 140,
      'Pedicure Gel - R120': 120,
      'Pedicure Acrylic - R160': 160
    },
    makeup: {
      'Natural Makeup - R200': 200,
      'Soft-Glam - R250': 250,
      'Glam - R300': 300,
      'Bridal (House Call only) - R400': 400
    },
    weave: {
      'Plain Weave Installation - R200': 200,
      'Styled Weave Installation - R300': 300
    },
    cavitation: {
      'Single Person: 1 Session without Lipopads - R600': 600,
      'Single Person: 1 Session with Lipopads - R800': 800,
      'Single Person: 3 Sessions without Lipopads - R1500': 1500,
      'Single Person: 3 Sessions with Lipopads - R2000': 2000,
      '2 People Combo: 1 Session without Lipopads - R1000': 1000,
      '2 People Combo: 1 Session with Lipopads - R1500': 1500,
      '2 People Combo: 3 Sessions without Lipopads - R2000': 2000,
      '2 People Combo: 3 Sessions with Lipopads - R4000': 4000
    }
  };

  const subServices = {
    nails: [
      'Short Plain Acrylic - R180',
      'Short with Design Acrylic - R220',
      'Medium Plain Acrylic - R220',
      'Medium with Design Acrylic - R260',
      'Large Plain Acrylic - R260',
      'Large with Design Acrylic - R300',
      'X-Large Plain Acrylic - R300',
      'X-Large with Design Acrylic - R350',
      'Gel Polish - R140',
      'Gel Overlay - R100',
      'Buff and Shine Plain - R100',
      'Buff and Shine with Design - R140',
      'Pedicure Gel - R120',
      'Pedicure Acrylic - R160'
    ],
    makeup: [
      'Natural Makeup - R200',
      'Soft-Glam - R250',
      'Glam - R300',
      'Bridal (House Call only) - R400'
    ],
    weave: [
      'Plain Weave Installation - R200',
      'Styled Weave Installation - R300'
    ],
    cavitation: [
      'Single Person: 1 Session without Lipopads - R600',
      'Single Person: 1 Session with Lipopads - R800',
      'Single Person: 3 Sessions without Lipopads - R1500',
      'Single Person: 3 Sessions with Lipopads - R2000',
      '2 People Combo: 1 Session without Lipopads - R1000',
      '2 People Combo: 1 Session with Lipopads - R1500',
      '2 People Combo: 3 Sessions without Lipopads - R2000',
      '2 People Combo: 3 Sessions with Lipopads - R4000'
    ]
  };

  const timeSlots = [
    '9:00 AM', '9:30 AM', '10:00 AM', '10:30 AM', '11:00 AM', '11:30 AM',
    '12:00 PM', '12:30 PM', '1:00 PM', '1:30 PM', '2:00 PM', '2:30 PM',
    '3:00 PM', '3:30 PM', '4:00 PM', '4:30 PM', '5:00 PM', '5:30 PM'
  ];

  // DOM references
  const serviceSelect = document.getElementById('service');
  const subServiceContainer = document.getElementById('subServiceContainer');
  const subServiceSelect = document.getElementById('subservice');
  const timeSelect = document.getElementById('time');
  const priceDisplay = document.getElementById('priceDisplay');
  const paymentMethodSelect = document.getElementById('paymentMethod');
  const cardDetailsSection = document.getElementById('cardDetails');
  const submitBookingBtn = document.getElementById('submitBookingBtn');
  const payfastForm = document.getElementById('payfast-form');
  const payfastAmountInput = document.getElementById('payfast-amount');
  const payfastBookingInfoInput = document.getElementById('payfast-booking-info');
  const bookingForm = document.getElementById('bookingForm');
  const modalBg = document.getElementById('bookingModal');
  const modalContent = document.getElementById('modalContent');
  const closeModalBtn = document.getElementById('closeModal');

  // Populate time slots
  function populateTimeSlots() {
    timeSelect.innerHTML = '<option value="">Select a time</option>';
    timeSlots.forEach(time => {
      const option = document.createElement('option');
      option.value = time;
      option.textContent = time;
      timeSelect.appendChild(option);
    });
  }

  // Populate subservices when service changes
  serviceSelect.addEventListener('change', () => {
    const service = serviceSelect.value;
    if (!service || !subServices[service]) {
      subServiceContainer.classList.add('hidden');
      subServiceSelect.innerHTML = '';
      priceDisplay.textContent = 'Total Price: R0';
      return;
    }

    subServiceContainer.classList.remove('hidden');
    subServiceSelect.innerHTML = '<option value="">Select an option...</option>';
    subServices[service].forEach(item => {
      const opt = document.createElement('option');
      opt.value = item;
      opt.textContent = item;
      subServiceSelect.appendChild(opt);
    });
    priceDisplay.textContent = 'Total Price: R0';
  });

  // Update price display on subservice selection
  subServiceSelect.addEventListener('change', () => {
    const service = serviceSelect.value;
    const subservice = subServiceSelect.value;
    if (service && subservice && priceMap[service] && priceMap[service][subservice]) {
      priceDisplay.textContent = 'Total Price: R' + priceMap[service][subservice];
    } else {
      priceDisplay.textContent = 'Total Price: R0';
    }
  });

  // Payment method selection logic
  paymentMethodSelect.addEventListener('change', () => {
    const method = paymentMethodSelect.value;
    if (method === 'card') {
      cardDetailsSection.classList.remove('hidden');
      payfastForm.style.display = 'block';
      submitBookingBtn.style.display = 'none';
    } else if (method === 'eft') {
      cardDetailsSection.classList.add('hidden');
      payfastForm.style.display = 'none';
      submitBookingBtn.style.display = 'inline-block';
    } else {
      cardDetailsSection.classList.add('hidden');
      payfastForm.style.display = 'none';
      submitBookingBtn.style.display = 'inline-block';
    }
  });

  // Simple validation function
  function validateForm() {
    const name = bookingForm.name.value.trim();
    const phone = bookingForm.phone.value.trim();
    const service = bookingForm.service.value;
    const subservice = bookingForm.subservice.value;
    const date = bookingForm.date.value;
    const time = bookingForm.time.value;
    const paymentMethod = paymentMethodSelect.value;

    if (!name) {
      alert('Please enter your full name.');
      return false;
    }
    if (!phone.match(/^\d{9,15}$/)) {
      alert('Please enter a valid phone number (digits only, 9-15 digits).');
      return false;
    }
    if (!service) {
      alert('Please select a service.');
      return false;
    }
    if (!subservice) {
      alert('Please select a specific option for the service.');
      return false;
    }
    if (!date) {
      alert('Please select a date.');
      return false;
    }
    if (!time) {
      alert('Please select a time.');
      return false;
    }
    if (!paymentMethod) {
      alert('Please select a payment method.');
      return false;
    }
    if (paymentMethod === 'card') {
      // Simple card validation
      const cardNumber = bookingForm.cardNumber.value.trim();
      const expiry = bookingForm.expiry.value.trim();
      const cvv = bookingForm.cvv.value.trim();

      if (!cardNumber.match(/^\d{13,19}$/)) {
        alert('Please enter a valid card number (13 to 19 digits).');
        return false;
      }
      if (!expiry.match(/^(0[1-9]|1[0-2])\/\d{2}$/)) {
        alert('Please enter a valid expiry date in MM/YY format.');
        return false;
      }
      if (!cvv.match(/^\d{3,4}$/)) {
        alert('Please enter a valid CVV.');
        return false;
      }
    }
    return true;
  }

  // Show modal with content
  function showModal(content) {
    modalContent.innerHTML = content;
    modalBg.style.display = 'flex';
    modalBg.focus();
  }

  // Close modal function
  closeModalBtn.addEventListener('click', () => {
    modalBg.style.display = 'none';
    bookingForm.reset();
    subServiceContainer.classList.add('hidden');
    cardDetailsSection.classList.add('hidden');
    payfastForm.style.display = 'none';
    submitBookingBtn.style.display = 'inline-block';
    priceDisplay.textContent = 'Total Price: R0';
  });

  // Close modal on background click
  modalBg.addEventListener('click', e => {
    if (e.target === modalBg) {
      closeModalBtn.click();
    }
  });

  // Form submission handler
  bookingForm.addEventListener('submit', e => {
    e.preventDefault();

    if (!validateForm()) {
      return;
    }

    const formData = new FormData(bookingForm);

    // Extract needed info
    const name = formData.get('name').trim();
    const phone = formData.get('phone').trim();
    const email = formData.get('email').trim() || 'Not provided';
    const service = formData.get('service');
    const subservice = formData.get('subservice');
    const date = formData.get('date');
    const time = formData.get('time');
    const paymentMethod = formData.get('paymentMethod');
    const notes = formData.get('notes').trim() || 'None';
    const price = priceMap[service][subservice];

    if (paymentMethod === 'card') {
      // Set PayFast form values
      payfastAmountInput.value = price.toFixed(2);
      const bookingInfo = `Name: ${name}, Phone: ${phone}, Email: ${email}, Service: ${service}, Option: ${subservice}, Date: ${date}, Time: ${time}, Notes: ${notes}`;
      payfastBookingInfoInput.value = bookingInfo;

      // Submit PayFast form
      payfastForm.submit();
      return;
    }

    // For EFT payment, just show booking confirmation modal & simulate sending messages

    const bookingSummary = `
      <p>Thank you <strong>${name}</strong> for your booking!</p>
      <p><strong>Service:</strong> ${service} - ${subservice}</p>
      <p><strong>Date & Time:</strong> ${date} at ${time}</p>
      <p><strong>Payment Method:</strong> EFT (Bank Transfer)</p>
      <p><strong>Total Price:</strong> R${price}</p>
      <p><strong>Phone:</strong> ${phone}</p>
      <p><strong>Email:</strong> ${email}</p>
      <p><strong>Additional Notes:</strong> ${notes}</p>
      <hr />
      <p><em>Please transfer the amount to our bank account and confirm via WhatsApp: <a href="https://wa.me/27610665969" target="_blank" rel="noopener">+27 61 066 5969</a></em></p>
    `;

    // TODO: Integrate actual WhatsApp or EmailJS API calls here if you want

    showModal(bookingSummary);
  });

  // Populate time slots on page load
  populateTimeSlots();
</script>

</body>
</html>
